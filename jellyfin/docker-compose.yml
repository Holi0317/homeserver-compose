version: "3.5"

services:
  jellyfin:
    image: jellyfin/jellyfin
    user: 2000:2000
    restart: always
    volumes:
      - jellyfin-config:/config
      - jellyfin-cache:/cache
      - jellyfin-media:/media
    networks:
      - traefik
      - default
    labels:
      traefik.enable: true
      traefik.http.services.jellyfin.loadbalancer.server.port: 8096
      traefik.docker.network: traefik
      traefik.http.routers.jellyfin.rule: Host(`jellyfin.holi0317.net`)
      traefik.http.routers.jellyfin.entrypoints: websecure
      traefik.http.routers.jellyfin.tls.certresolver: myhttpchallenge
      traefik.http.routers.jellyfin.middlewares: compress@file,secure_head@file

volumes:
  jellyfin-config:
    driver: local-persist
    driver_opts:
      mountpoint: ${BASE_PATH?"Base path not defined"}/jellyfin/config
  jellyfin-cache:
    driver: local-persist
    driver_opts:
      mountpoint: ${BASE_PATH?"Base path not defined"}/jellyfin/cache
  jellyfin-media:
    driver: local-persist
    driver_opts:
      mountpoint: ${BASE_PATH?"Base path not defined"}/jellyfin/media

networks:
  traefik:
    external:
      name: traefik
  default:
